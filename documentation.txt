// main.cpp - Your weather balloon monitoring loop

int main() {
    // 1. Authenticate once at startup
    auto auth = std::make_shared<GmailAuth>("client_secret.json");
    auth->authenticate();
    
    // 2. Create client
    GmailClient client(auth);
    
    // 3. Poll for new messages every 5 minutes
    while (true) {
        // Get messages from modem in last 10 minutes
        auto messages = client.searchAndGetMessages(
            "from:your-modem@example.com newer_than:10m", 
            10  // Adjust based on how many you expect
        );
        
        // 4. Process each message
        for (const auto& msg : messages) {
            // Extract and parse (BalloonDataParser will do this)
            std::string hexData = extractHex(msg.bodyText);
            BalloonTelemetry data = parseHex(hexData);
            
            // Update dashboard
            updateDashboard(data);
        }
        
        // 5. Wait 5 minutes
        std::this_thread::sleep_for(std::chrono::minutes(5));
    }
    
    return 0;
}